<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>regist form</title>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.1.min.js"></script>
<script>


</script>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
<script src="https://code.jquery.com/jquery-latest.js"></script>
<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
<script src="/static/js/MyConfig.js"></script>
<style>
body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif}
body {font-size:16px;}
.w3-half img{margin-bottom:-6px;margin-top:16px;opacity:0.8;cursor:pointer}
.w3-half img:hover{opacity:1}
@font-face {
    font-family: 'BMJUA';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/BMJUA.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
a{
	text-decoration-line : none;
}
table, tr, td {
    border: collapse;
    padding: 13px;
}
table{
	width:400px;
}
tr {
    display: table-row;
    vertical-align: inherit;
    border-color: inherit;
    text: align;
}
td {
    display: table-cell;
    vertical-align: inherit;
    width: 144px;
}
</style>
<script>

window.addEventListener("load", function() {
	web3 = new Web3(
			new Web3.providers.HttpProvider("http://localhost:7545"));
});

/// 자바스크립트를 이용해서 파일 읽어오기
function onFileSelected(event) {
	const file = event.target.files[0];
	const reader = new FileReader();
	reader.onload = function(event) {
		console.log("파일 내용 :" + event.target.result);
		const privateKey = event.target.result;
		/// 지갑
		const account = web3.eth.accounts.privateKeyToAccount(privateKey);
		const address = account.address;
		console.log("address : " + address);
		$.ajax({
			type : "post",
			dataType : "text",
			url : "/login/privateLogin",
			data : {
				"address" : address
			},
			success : function(result) {
				if (result == "1") {
					location.href = "/";
				} else {
					alert("인증서에 해당하는 사용자가 없어 로그인되지 않았습니다.");
					location.reload();
				}
			},
			error : function() {
				alert("오류입니다.");
				return false;
			}
		});
	}
	reader.readAsText(file);
}




// Script to open and close sidebar
function w3_open() {
  document.getElementById("mySidebar").style.display = "block";
  document.getElementById("myOverlay").style.display = "block";
}
 
function w3_close() {
  document.getElementById("mySidebar").style.display = "none";
  document.getElementById("myOverlay").style.display = "none";
}

</script>
</head>
<body>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-green w3-collapse w3-top w3-large w3-padding" style="z-index:3;width:300px;font-weight:bold;" id="mySidebar"><br>
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-button w3-hide-large w3-display-topleft" style="width:100%;font-size:22px">Close Menu</a>
  <div class="w3-container">
    <h3 class="w3-padding-64"><b><a href="/">HOUZZ</a></b></h3>
    
  </div>
</nav>

<!-- Top menu on small screens -->
<header class="w3-container w3-top w3-hide-large w3-green w3-xlarge w3-padding">
  <a href="javascript:void(0)" class="w3-button w3-green w3-margin-right" onclick="w3_open()">☰</a>
  <span>Company Name</span>
</header>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:340px;margin-right:40px">

  <!-- Header -->
  <div class="w3-container" style="margin-top:80px" id="showcase">
    <h1 class="w3-jumbo"><b>HOUZZ</b></h1>
    <h1 class="w3-xxxlarge w3-text-green"><b>로그인</b></h1>
    	
    <hr style="width:50px;border:5px solid green" class="w3-round">	
  </div>
  
  <!-- MemberRegist -->
  <div class="w3-container" id="services" style="margin-top:75px">
            
        
	<form action="/login/loginPro" name="frm" id="frm" method="post" th:object="${loginCommand}">
		<table border="1" align="center" width="70%" height="70%">
		     <tr>
				<td colspan="3" align="center" style="background-color: green">
				<h1 style="color : white">Houzz</h1></td>		
			<tr>
				<td align="center" ><input type="text" name="userId" id="userId" placeholder="아이디" th:value="${loginCommand.userId}"/>
				  <br />	<span style="color:red" th:if="${#fields.hasErrors('userId')}" th:errors="*{userId}"></span>
				</td>	
			</tr>
			<tr>
				<td align="center"><input type="password" name="userPw" id="userPw" placeholder="비밀번호" th:value="${loginCommand.userPw}">
				<br /><span style="color:red" th:if="${#fields.hasErrors('userPw')}" th:errors="*{userPw}"></span>
				</td>
			</tr>
			<tr>
				<td colspan="3" align="left" style="color : black">
				       <input type="submit" value="로그인"> 
				       <br />
				       <hr/>
				       <input type="file" onchange="onFileSelected(event)">(인증서 로그인)</td>		
			<tr>
				<td colspan="3">자동 로그인 <input type="checkbox" name="autoLogin" />
					&nbsp;&nbsp;&nbsp;&nbsp; 아이디 저장 <input type="checkbox"
					name="idStore" th:checked="${loginCommand.idStore != null && loginCommand.idStore}"/>
					&nbsp;&nbsp;
				</td>
		</table>
		<table align="center">
			<tr>
				<td>
				    <a href="/register/agree">회원가입 |</a>
				    <a href="/find/findId">아이디찾기 |</a>
				    <a href="/find/findPw">비밀번호찾기 |</a>
				    <a href="/employee/empRegist">직원등록</a>  
				</td>
			</tr>	
		</table>
	</form>
	
  </div>

<!-- End page content -->
</div>

<!-- W3.CSS Container -->
<div class="w3-light-grey w3-container w3-padding-32" style="margin-top:75px;padding-right:58px"><p class="w3-right">Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-opacity">w3.css</a></p></div>

</body>
</html>